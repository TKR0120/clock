<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhyming Clock</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f3f3f3;
            font-family: 'VT323', monospace;
        }
        
        .clock-container {
            width: 600px;
            height: 320px;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.2),
                inset 0 1px 0 rgba(255,255,255,0.1),
                inset 0 -1px 0 rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .clock-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }
        
        .display-frame {
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 
                inset 0 2px 10px rgba(0,0,0,0.5),
                inset 0 -1px 0 rgba(255,255,255,0.05);
            position: relative;
        }
        
        .display-screen {
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 5px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .display-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(rgba(255,255,255,0.02) 50%, transparent 50%);
            background-size: 100% 4px;
            pointer-events: none;
            opacity: 0.4;
        }
        
        #poem-display {
            color: #00ff88;
            font-size: 24px;
            line-height: 1.6;
            font-weight: 400;
            text-align: left;
            text-shadow: 0 0 10px rgba(0,255,136,0.3);
            white-space: pre-line;
            width: 100%;
            z-index: 1;
            font-family: 'VT323', monospace;
        }
        
        .time-indicator {
            position: absolute;
            bottom: 10px;
            right: 20px;
            color: #00ff88;
            font-size: 16px;
            opacity: 0.5;
            font-weight: 400;
            font-family: 'VT323', monospace;
        }
        
        .power-light {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,255,136,0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .typing-effect {
            display: inline;
            border-right: 2px solid #00ff88;
            animation: blink-caret 0.75s step-end infinite;
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #00ff88; }
        }
    </style>
</head>
<body>
    <div class="clock-container">
        <div class="display-frame">
            <div class="power-light"></div>
            <div class="display-screen">
                <div id="poem-display"></div>
                <div class="time-indicator" id="time-indicator"></div>
            </div>
        </div>
    </div>

    <script>
        const TRANSLATIONS = {
            "en-US": {
                "poemPrompt": "Write a 4-line acrostic love poem where each line starts with a digit from the time {timeString} (format: HH:MM). The first line starts with the first digit of the hour, second line with the second digit of the hour, third line with the first digit of the minute, fourth line with the second digit of the minute. Each line should express romantic feelings or moments. Make it elegant and heartfelt. Respond with ONLY the poem text, no explanation.",
                "fallbackPoem": "Love blooms at {timeString} tonight,\nOur hearts beating in perfect time,\nVows whispered soft in candlelight,\nEternal moments, forever thine.",
                "errorMessage": "Error generating poem:"
            },
            /* LOCALE_PLACEHOLDER_START */
            "zh-TW": {
                "poemPrompt": "請寫一首四行的愛情藏頭詩，每一行的開頭必須是時間 {timeString} 的數字（格式：HH:MM）。第一行用小時的第一個數字開頭，第二行用小時的第二個數字開頭，第三行用分鐘的第一個數字開頭，第四行用分鐘的第二個數字開頭。每一行都要表達浪漫的情感或愛情時刻。詩句要優雅動人。只回覆詩句本身，不要任何解釋。",
                "fallbackPoem": "愛在{timeString}悄然降臨，\n情深意重心相印，\n時光荏苒情不變，\n刻骨銘心到永恆。",
                "errorMessage": "生成詩句時發生錯誤："
            },
            "ja-JP": {
                "poemPrompt": "{timeString}の時刻について、非常に短い（2-4行）ミニマリストの詩を書いてください。詩は韻を踏み、優雅でシンプルでなければなりません。時刻の具体的な数字に焦点を当ててください。詩は俳句のように思索的で正確な感じにしてください。詩のテキストのみを返し、タイトルや説明は不要です。",
                "fallbackPoem": "{timeString}に時計が鳴る、\n時を刻み、刻々と。",
                "errorMessage": "詩の生成中にエラーが発生しました："
            }
            /* LOCALE_PLACEHOLDER_END */
        };

        // Fixed to Traditional Chinese
        const locale = 'zh-TW';
        const t = (key) => TRANSLATIONS[locale]?.[key] || TRANSLATIONS['en-US'][key] || key;

        const poemDisplay = document.getElementById('poem-display');
        const timeIndicator = document.getElementById('time-indicator');
        let currentMinute = -1;
        let isTyping = false;

        // Create audio context for typing sounds
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function createTypingSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Softer sine wave instead of square wave
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // Lower frequency, more pleasant
            
            // Gentle volume envelope
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.02, audioContext.currentTime + 0.01); // Soft attack
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.1); // Gentle decay
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function formatTime(date) {
            return date.toLocaleTimeString(locale, { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: locale.startsWith('en') 
            });
        }

        async function generatePoem(time) {
            const hour = time.getHours();
            const minute = time.getMinutes();
            const timeString = formatTime(time);
            
            const prompt = t('poemPrompt').replace('{timeString}', timeString) + ` Please respond in ${locale} language`;
            
            try {
                const response = await window.claude.complete(prompt);
                return response.trim();
            } catch (error) {
                console.error(t('errorMessage'), error);
                return t('fallbackPoem').replace('{timeString}', timeString);
            }
        }

        async function typePoem(poem) {
            isTyping = true;
            poemDisplay.innerHTML = '';
            
            for (let i = 0; i < poem.length; i++) {
                poemDisplay.innerHTML = poem.substring(0, i + 1) + '<span class="typing-effect"></span>';
                if (poem[i] !== ' ' && poem[i] !== '\n') {
                    createTypingSound();
                }
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            poemDisplay.innerHTML = poem;
            isTyping = false;
        }

        async function updateClock() {
            const now = new Date();
            const currentMinuteNow = now.getMinutes();
            
            timeIndicator.textContent = formatTime(now);
            
            if (currentMinuteNow !== currentMinute && !isTyping) {
                currentMinute = currentMinuteNow;
                const poem = await generatePoem(now);
                await typePoem(poem);
            }
        }

        // Initial update
        updateClock();
        
        // Update every second
        setInterval(updateClock, 1000);
        
        // Handle user interaction to enable audio
        document.addEventListener('click', function initAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            document.removeEventListener('click', initAudio);
        }, { once: true });
    </script>
</body>
</html>
